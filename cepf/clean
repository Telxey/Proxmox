#!/usr/bin/env bash
set -euo pipefail
# Copyright (c) 2021-2024 Telxey
# Author: TELXEY (Rax)
# License: MIT

# Color definitions
bold=$(echo -en "\e[1m")
dim=$(echo -en "\e[2m")
blink=$(echo -en "\e[5m")
normal=$(echo -en "\e[0m")
red=$(echo -en "\e[31m")
green=$(echo -en "\e[32m")
orange=$(echo -en "\e[33m")
YW=$(echo "\033[33m")
BL=$(echo "\033[36m")
RD=$(echo "\033[01;31m")
BGN=$(echo "\033[4;92m")
GN=$(echo "\033[1;92m")
DGN=$(echo "\033[32m")
CL=$(echo "\033[m")
CM="${GN}✓${CL}"
CROSS="${RD}✗${CL}"
BFR="\\r\\033[K"
HOLD="-"

# Banner function
show_banner() {
    local text="$1"
    local color="$2"
    echo -e "${color}${bold}"
    echo "============================================================"
    echo "$text"
    echo "============================================================"
    echo -e "${normal}"
}

show_warning_banner() {
    echo "${red}${bold}${blink}"
    cat <<"EOF"
         ██╗    ██╗ █████╗ ██████╗ ███╗   ██╗██╗ ██████╗ 
         ██║    ██║██╔══██╗██╔══██╗████╗  ██║██║██╔════╝ 
         ██║ █╗ ██║███████║██████╔╝██╔██╗ ██║██║██║  ███╗
         ██║███╗██║██╔══██║██╔══██╗██║╚██╗██║██║██║   ██║
         ╚███╔███╔╝██║  ██║██║  ██║██║ ╚████║██║╚██████╔╝
          ╚══╝╚══╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═══╝╚═╝ ╚═════╝ 
EOF
    echo "${normal}"
    show_banner "DANGER: This script will remove all Ceph components" "${red}"
}

show_ceph_banner() {
    echo "${orange}"
    cat <<"EOF"
        ▄████▄  ▓█████ ██▓███   ▒ ████▒     ▄████▄   ██▓    ▓█████ ▄▄▄      ███▄    █  ▓█████ ██▀███  
       ▒██▀ ▀█  ▓█   ▀▓██░  ██ ▒▓██        ▒██▀ ▀█  ▓██▒    ▓█   ▀▒████▄    ██ ▀█   █  ▓█   ▀▓██ ▒ ██▒
       ▒▓█    ▄ ▒███  ▓██░ ██▓▒░▒████      ▒▓█    ▄ ▒██░    ▒███  ▒██  ▀█▄ ▓██  ▀█ ██▒ ▒███  ▓██ ░▄█ ▒
       ▒▓▓▄ ▄██ ▒▓█  ▄▒██▄█▓▒ ▒░░▓█▒       ▒▓▓▄ ▄██ ▒██░    ▒▓█  ▄░██▄▄▄▄██▓██▒  ▐▌██▒ ▒▓█  ▄▒██▀▀█▄  
       ▒ ▓███▀ ▒░▒████▒██▒ ░  ░ ░▒█░       ▒ ▓███▀ ▒░██████▒░▒████▒▓█   ▓██▒██░   ▓██░▒░▒████░██▓ ▒██▒
       ░ ░▒ ▒  ░░░ ▒░ ▒▓▒░ ░  ░  ▒ ░       ░ ░▒ ▒  ░░ ▒░▓  ░░░ ▒░ ░▒▒   ▓▒█░ ▒░   ▒ ▒ ░░░ ▒░ ░ ▒▓ ░▒▓░
         ░  ▒  ░ ░ ░  ░▒ ░       ░           ░  ▒  ░░ ░ ▒  ░ ░ ░  ░ ░   ▒▒ ░ ░░   ░ ▒░░ ░ ░    ░▒ ░ ▒ 
       ░           ░  ░░         ░ ░       ░          ░ ░      ░    ░   ▒     ░   ░ ░     ░    ░░   ░ 
       ░ ░     ░   ░                       ░ ░     ░    ░  ░   ░        ░           ░ ░   ░     ░     
EOF
    echo "${normal}"
}

show_progress_banner() {
    local step="$1"
    local total="$2"
    show_banner "Progress: Step $step of $total" "${green}"
}

# [Previous spinner and exec_with_spinner functions remain the same]

cleanup_ceph() {
    local total_steps=7
    local current_step=1

    show_progress_banner $current_step $total_steps
    # Stop services with visual feedback
    for service in "ceph-mon" "ceph-mgr" "ceph-mds" "ceph-osd"; do
        exec_with_spinner "systemctl stop $service.target" "Stopping $service"
        ((current_step++))
        show_progress_banner $current_step $total_steps
    done

    # [Previous cleanup steps remain the same but add progress banners]
    show_banner "Cleanup Complete" "${green}"
}

# Main execution
clear
show_warning_banner
show_ceph_banner

echo "${orange}${bold}Do you wish to continue removing Ceph?"
echo "${green}For continue press 1 ${white}${bold} or ${red}For cancel press 2 ${normal}"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) break;;
        No ) echo "${red}Installation canceled${normal}"; exit;;
    esac
done

# [Rest of the main execution remains the same]
